<!DOCTYPE html>
<html lang="si" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ලියාපදිංචි වන්න - Helakapuwa.com</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .bg-primary { background-color: #0096C7; }
        .text-primary { color: #0096C7; }
        .border-primary { border-color: #0096C7; }
        .hover\:bg-primary-dark:hover { background-color: #007BB5; }
        .focus\:border-primary:focus { border-color: #0096C7; }
        .focus\:ring-primary:focus { box-shadow: 0 0 0 3px rgba(0, 150, 199, 0.1); }
        
        .form-step {
            display: none;
        }
        .form-step.active {
            display: block;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #0096C7 var(--progress), #e5e7eb var(--progress));
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <a href="index.html" class="text-2xl font-bold text-primary">
                        <i class="fas fa-heart mr-2"></i>Helakapuwa.com
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="login.html" class="text-gray-600 hover:text-primary transition-colors">
                        ප්‍රවේශ වන්න
                    </a>
                    <a href="index.html" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors">
                        මුල් පිටුව
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
            <!-- Progress Bar -->
            <div class="bg-gray-200 h-2">
                <div id="progressBar" class="progress-bar h-2 transition-all duration-300" style="--progress: 33%"></div>
            </div>
            
            <!-- Header -->
            <div class="px-6 py-8 text-center border-b border-gray-200">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">
                    ඔබේ ජීවිත සහකරු සොයා ගන්න
                </h1>
                <p class="text-gray-600">
                    Helakapuwa.com හි ලියාපදිංචි වී ඔබේ සුදුසු සහකරු සොයා ගන්න
                </p>
                <div class="flex justify-center mt-4">
                    <div class="flex items-center space-x-4 text-sm text-gray-500">
                        <span class="flex items-center">
                            <span id="step1Indicator" class="w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center mr-2">1</span>
                            මූලික තොරතුරු
                        </span>
                        <span class="flex items-center">
                            <span id="step2Indicator" class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center mr-2">2</span>
                            පෞද්ගලික විස්තර
                        </span>
                        <span class="flex items-center">
                            <span id="step3Indicator" class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center mr-2">3</span>
                            කැමැත්ත
                        </span>
                    </div>
                </div>
            </div>

            <!-- Registration Form -->
            <form id="registrationForm" class="p-6">
                <!-- Step 1: Basic Information -->
                <div class="form-step active" id="step1">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">මූලික තොරතුරු</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="firstName" class="block text-sm font-medium text-gray-700 mb-2">
                                මුල් නම *
                            </label>
                            <input type="text" id="firstName" name="firstName" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="ඔබේ මුල් නම ඇතුළත් කරන්න">
                        </div>
                        
                        <div>
                            <label for="lastName" class="block text-sm font-medium text-gray-700 mb-2">
                                අන්තිම නම *
                            </label>
                            <input type="text" id="lastName" name="lastName" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="ඔබේ අන්තිම නම ඇතුළත් කරන්න">
                        </div>
                        
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                                ඊ-මේල් ලිපිනය *
                            </label>
                            <input type="email" id="email" name="email" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="your.email@example.com">
                        </div>
                        
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">
                                දුරකථන අංකය
                            </label>
                            <input type="tel" id="phone" name="phone"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="071xxxxxxx">
                        </div>
                        
                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                                මුරපදය *
                            </label>
                            <input type="password" id="password" name="password" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="අවම වශයෙන් අක්ෂර 8ක් ">
                        </div>
                        
                        <div>
                            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-2">
                                මුරපදය නැවත ඇතුළත් කරන්න *
                            </label>
                            <input type="password" id="confirmPassword" name="confirmPassword" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="මුරපදය නැවත ඇතුළත් කරන්න">
                        </div>
                        
                        <div>
                            <label for="gender" class="block text-sm font-medium text-gray-700 mb-2">
                                ස්ත්‍රී පුරුෂ භාවය *
                            </label>
                            <select id="gender" name="gender" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">තෝරන්න</option>
                                <option value="Male">පුරුෂ</option>
                                <option value="Female">ගැහැණු</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="dob" class="block text-sm font-medium text-gray-700 mb-2">
                                උපන් දිනය *
                            </label>
                            <input type="date" id="dob" name="dob" required
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                        </div>
                    </div>
                </div>

                <!-- Step 2: Personal Details -->
                <div class="form-step" id="step2">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">පෞද්ගලික විස්තර</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="religion" class="block text-sm font-medium text-gray-700 mb-2">
                                ආගම
                            </label>
                            <select id="religion" name="religion"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">තෝරන්න</option>
                                <option value="Buddhist">බෞද්ධ</option>
                                <option value="Hindu">හින්දු</option>
                                <option value="Christian">ක්‍රිස්තියානි</option>
                                <option value="Islam">ඉස්ලාම්</option>
                                <option value="Other">වෙනත්</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="caste" class="block text-sm font-medium text-gray-700 mb-2">
                                කුල
                            </label>
                            <input type="text" id="caste" name="caste"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="කුල ඇතුළත් කරන්න">
                        </div>
                        
                        <div>
                            <label for="maritalStatus" class="block text-sm font-medium text-gray-700 mb-2">
                                විවාහක තත්ත්වය
                            </label>
                            <select id="maritalStatus" name="maritalStatus"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">තෝරන්න</option>
                                <option value="Single">අවිවාහක</option>
                                <option value="Divorced">දික්කසාද</option>
                                <option value="Widowed">වැන්දඹු</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="education" class="block text-sm font-medium text-gray-700 mb-2">
                                අධ්‍යාපන මට්ටම
                            </label>
                            <select id="education" name="education"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">තෝරන්න</option>
                                <option value="O/L">සාමාන්‍ය පෙළ</option>
                                <option value="A/L">උසස් පෙළ</option>
                                <option value="Diploma">ඩිප්ලෝමා</option>
                                <option value="Degree">උපාධිය</option>
                                <option value="Masters">ශාස්ත්‍රපති</option>
                                <option value="PhD">ආචාර්ය</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="profession" class="block text-sm font-medium text-gray-700 mb-2">
                                රැකියාව
                            </label>
                            <input type="text" id="profession" name="profession"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="ඔබේ රැකියාව ඇතුළත් කරන්න">
                        </div>
                        
                        <div>
                            <label for="income" class="block text-sm font-medium text-gray-700 mb-2">
                                ආදායම් පරාසය
                            </label>
                            <select id="income" name="income"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">තෝරන්න</option>
                                <option value="Below 30k">30,000 ට අඩු</option>
                                <option value="30k-50k">30,000 - 50,000</option>
                                <option value="50k-100k">50,000 - 100,000</option>
                                <option value="100k-200k">100,000 - 200,000</option>
                                <option value="Above 200k">200,000 ට වැඩි</option>
                            </select>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label for="city" class="block text-sm font-medium text-gray-700 mb-2">
                                නගරය
                            </label>
                            <input type="text" id="city" name="city"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="ඔබ ජීවත් වන නගරය">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label for="aboutMe" class="block text-sm font-medium text-gray-700 mb-2">
                                ඔබ ගැන කොටසට සාරාංශයක්
                            </label>
                            <textarea id="aboutMe" name="aboutMe" rows="4"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="ඔබ ගැන කෙටි විස්තරයක් ලියන්න..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Partner Preferences -->
                <div class="form-step" id="step3">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">සහකරු කැමැත්ත</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="prefMinAge" class="block text-sm font-medium text-gray-700 mb-2">
                                අවම වයස
                            </label>
                            <select id="prefMinAge" name="prefMinAge"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">තෝරන්න</option>
                                <option value="18">18</option>
                                <option value="20">20</option>
                                <option value="22">22</option>
                                <option value="25">25</option>
                                <option value="28">28</option>
                                <option value="30">30</option>
                                <option value="35">35</option>
                                <option value="40">40</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="prefMaxAge" class="block text-sm font-medium text-gray-700 mb-2">
                                උපරිම වයස
                            </label>
                            <select id="prefMaxAge" name="prefMaxAge"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">තෝරන්න</option>
                                <option value="25">25</option>
                                <option value="30">30</option>
                                <option value="35">35</option>
                                <option value="40">40</option>
                                <option value="45">45</option>
                                <option value="50">50</option>
                                <option value="55">55</option>
                                <option value="60">60</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="prefReligion" class="block text-sm font-medium text-gray-700 mb-2">
                                කැමති ආගම
                            </label>
                            <select id="prefReligion" name="prefReligion"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">ඕනෑම</option>
                                <option value="Buddhist">බෞද්ධ</option>
                                <option value="Hindu">හින්දු</option>
                                <option value="Christian">ක්‍රිස්තියානි</option>
                                <option value="Islam">ඉස්ලාම්</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="prefEducation" class="block text-sm font-medium text-gray-700 mb-2">
                                කැමති අධ්‍යාපන මට්ටම
                            </label>
                            <select id="prefEducation" name="prefEducation"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors">
                                <option value="">ඕනෑම</option>
                                <option value="A/L">උසස් පෙළ සහ ඊට වැඩි</option>
                                <option value="Diploma">ඩිප්ලෝමා සහ ඊට වැඩි</option>
                                <option value="Degree">උපාධිය සහ ඊට වැඩි</option>
                                <option value="Masters">ශාස්ත්‍රපති සහ ඊට වැඩි</option>
                            </select>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label for="prefLocation" class="block text-sm font-medium text-gray-700 mb-2">
                                කැමති ප්‍රදේශය
                            </label>
                            <input type="text" id="prefLocation" name="prefLocation"
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                                placeholder="කැමති ප්‍රදේශය ඇතුළත් කරන්න">
                        </div>
                    </div>
                    
                    <!-- Terms and Conditions -->
                    <div class="mt-8 border-t border-gray-200 pt-6">
                        <div class="flex items-start">
                            <input type="checkbox" id="termsAccepted" name="termsAccepted" required
                                class="mt-1 h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
                            <label for="termsAccepted" class="ml-3 text-sm text-gray-600">
                                මම <a href="terms.html" class="text-primary hover:underline">නියම සහ කොන්දේසි</a> සහ 
                                <a href="privacy.html" class="text-primary hover:underline">පෞද්ගලිකත්ව ප්‍රතිපත්ති</a> කියවා 
                                පිළිගනිමි. *
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Form Navigation -->
                <div class="flex justify-between items-center mt-8 pt-6 border-t border-gray-200">
                    <button type="button" id="prevBtn" 
                        class="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                        disabled>
                        <i class="fas fa-arrow-left mr-2"></i>පෙර
                    </button>
                    
                    <div class="text-sm text-gray-500">
                        <span id="currentStep">1</span> / 3
                    </div>
                    
                    <button type="button" id="nextBtn" 
                        class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                        ඊළඟ<i class="fas fa-arrow-right ml-2"></i>
                    </button>
                    
                    <button type="submit" id="submitBtn" 
                        class="px-8 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
                        <i class="fas fa-check mr-2"></i>ලියාපදිංචි වන්න
                    </button>
                </div>
            </form>
        </div>

        <!-- Additional Info -->
        <div class="mt-8 text-center">
            <p class="text-gray-600">
                දැනටමත් ගිණුමක් තිබේද? 
                <a href="login.html" class="text-primary hover:underline font-medium">ප්‍රවේශ වන්න</a>
            </p>
        </div>
    </main>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-8 text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
            <p class="text-gray-600">ලියාපදිංචි කරමින්...</p>
        </div>
    </div>

    <script>
        // Multi-step form functionality
        let currentStep = 1;
        const totalSteps = 3;

        function showStep(step) {
            // Hide all steps
            document.querySelectorAll('.form-step').forEach(stepEl => {
                stepEl.classList.remove('active');
            });
            
            // Show current step
            document.getElementById(`step${step}`).classList.add('active');
            
            // Update progress bar
            const progress = (step / totalSteps) * 100;
            document.getElementById('progressBar').style.setProperty('--progress', `${progress}%`);
            
            // Update step indicators
            for (let i = 1; i <= totalSteps; i++) {
                const indicator = document.getElementById(`step${i}Indicator`);
                if (i <= step) {
                    indicator.classList.remove('bg-gray-300', 'text-gray-600');
                    indicator.classList.add('bg-primary', 'text-white');
                } else {
                    indicator.classList.remove('bg-primary', 'text-white');
                    indicator.classList.add('bg-gray-300', 'text-gray-600');
                }
            }
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.disabled = step === 1;
            
            if (step === totalSteps) {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            } else {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            }
            
            // Update current step indicator
            document.getElementById('currentStep').textContent = step;
        }

        function validateStep(step) {
            const stepElement = document.getElementById(`step${step}`);
            const requiredInputs = stepElement.querySelectorAll('[required]');
            let isValid = true;

            requiredInputs.forEach(input => {
                if (!input.value.trim()) {
                    input.classList.add('border-red-500');
                    isValid = false;
                } else {
                    input.classList.remove('border-red-500');
                }
            });

            // Additional validation for step 1
            if (step === 1) {
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (password.length < 8) {
                    document.getElementById('password').classList.add('border-red-500');
                    isValid = false;
                }
                
                if (password !== confirmPassword) {
                    document.getElementById('confirmPassword').classList.add('border-red-500');
                    isValid = false;
                }
            }

            return isValid;
        }

        // Event listeners
        document.getElementById('nextBtn').addEventListener('click', () => {
            if (validateStep(currentStep)) {
                if (currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                }
            } else {
                alert('කරුණාකර සියලුම අවශ්‍ය ක්ෂේත්‍ර පුරවන්න.');
            }
        });

        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        });

        // Form submission
        document.getElementById('registrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!validateStep(currentStep)) {
                alert('කරුණාකර සියලුම අවශ්‍ය ක්ෂේත්‍ර පුරවන්න.');
                return;
            }

            // Show loading modal
            document.getElementById('loadingModal').classList.remove('hidden');

            // Collect form data
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('api/register.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                // Hide loading modal
                document.getElementById('loadingModal').classList.add('hidden');

                if (result.success) {
                    alert('ලියාපදිංචිය සාර්ථකයි! ප්‍රවේශ පිටුවට යොමු වේ...');
                    window.location.href = 'login.html';
                } else {
                    alert('දෝෂයක්: ' + result.message);
                }
            } catch (error) {
                // Hide loading modal
                document.getElementById('loadingModal').classList.add('hidden');
                alert('ලියාපදිංචිය අසාර්ථකයි. කරුණාකර නැවත උත්සාහ කරන්න.');
                console.error('Error:', error);
            }
        });

        // Real-time validation feedback
        document.addEventListener('input', (e) => {
            if (e.target.hasAttribute('required')) {
                if (e.target.value.trim()) {
                    e.target.classList.remove('border-red-500');
                }
            }
        });

        // Password confirmation validation
        document.getElementById('confirmPassword').addEventListener('input', (e) => {
            const password = document.getElementById('password').value;
            const confirmPassword = e.target.value;
            
            if (password === confirmPassword) {
                e.target.classList.remove('border-red-500');
                e.target.classList.add('border-green-500');
            } else {
                e.target.classList.remove('border-green-500');
                e.target.classList.add('border-red-500');
            }
        });

        // Initialize form
        showStep(currentStep);
    </script>
</body>
</html>
